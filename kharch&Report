 public ResponseEntity<ApiResponse> saveOrUpdateTotalPetrolStock(@RequestBody PetrolStockRequest request) {
        String userId = request.getUserId();
        String date = request.getDate();
        double minP = request.getPetrolRemaining();

        if (dailyskockRepository.countByDate(date, userId) == 0) {
            dailyskockRepository.insertDailyStock(date, minP, userId);
            return ResponseEntity.ok(new ApiResponse("Petrol stock saved successfully."));
        } else {
            dailyskockRepository.updateDailyStock(date, minP, userId); // New update method
            return ResponseEntity.ok(new ApiResponse("Petrol stock updated successfully."));
        }
    }


  @Modifying
    @Transactional
    @Query(value = "UPDATE dailystock SET openstock = :openstock WHERE date = :date AND user_id = :userId", nativeQuery = true)
    void updateDailyStock(@Param("date") String date,
                          @Param("openstock") double openstock,
                          @Param("userId") String userId);
//////////////////////////////////////
 public ResponseEntity<ApiResponse> saveOrUpdateDieselStock(@RequestBody DieselStockRequest request) {
        String userId = request.getUserId();
        String date = request.getDate();
        double minP = request.getDieselRemaining();
  if (dailydieselstockRepository.countByDate(date, userId) == 0) {
            dailydieselstockRepository.insertDailydieselstock(date, minP, userId);
            System.out.println("Diesel stock saved for date " + date);
            return ResponseEntity.ok(new ApiResponse("Diesel stock saved successfully."));
        } else {
            dailydieselstockRepository.updateDailydieselstock(date, minP, userId);
            System.out.println("Diesel stock updated for date " + date);
            return ResponseEntity.ok(new ApiResponse("Diesel stock updated successfully."));
        }
    }
 @Modifying
    @Transactional
    @Query("UPDATE dailydieselstock d SET d.dieselopenstock = :dieselopenstock WHERE d.date = :date AND d.user_id = :userId")
    void updateDailydieselstock(@Param("date") String date,
                                @Param("dieselopenstock") double dieselopenstock,
                                @Param("userId") String userId);
///////////////////////////////////////////////////////////////////////////

<div class="example-card">
    <div class="card-header card-header-danger text-center" style="background-color: rgb(244, 75, 75);margin-top: -2%;">
       <h4 class="card-title">Kharch :-</h4>
    </div>
    <div style="display:inline;width:100%">
       <div class="d-flex align-items-center" style="gap: 36%;">
          <mat-form-field appearance="fill" style="width: 50%;">   
             <input matInput [(ngModel)]="purchaDipStockseDetails.date" type="date" placeholder="Select Date" />
          </mat-form-field>
          <button mat-raised-button color="primary" (click)="expense()">Expenses Add</button>
       </div>
       <div style="display:inline;">
          <button (click)="addTable()">Add Row</button>
       </div>
       <div style="display:inline;margin-left:25%">
          <button (click)="cancel()">cancel</button>
          <button (click)="order()">Add</button>
       </div>
    </div>
    <br />
    <table class="style">
       <tr>
          <th style="width: 16%;">RowId</th>
          <th>Indirect Expenses</th>
          <th>Price</th>
          <th>Note</th>
          <th>Delete</th>
       </tr>
       <tr *ngFor="let item of row; let i = index">
          <td><input style="text-align: center;" type="text" [(ngModel)]="item.idkharch" /></td>
          <td>
             <mat-form-field style="margin-top: 4%; background-color: rgb(252, 252, 252); width: 100%;">
                <mat-select [(ngModel)]="item.expenses" (openedChange)="onSelectOpened()">
                <!-- Static Search Box -->
                <mat-option disabled>
                   <div style="display: flex; align-items: center; padding: 4px;">
                      <span style="margin-right: 8px; font-size: 18px;">üîç</span>
                      <input
                      type="text"
                      placeholder="Search..."
                      [(ngModel)]="searchText"
                      (ngModelChange)="onSearchChange()"
                      style="
                      padding: 6px 8px;
                      font-size: 19px;
                      border: none;
                      "
                      />
                   </div>
                </mat-option>
                <!-- Filtered options -->
                <mat-option *ngFor="let expense of filteredExpenses" [value]="expense">
                {{ expense }}
                </mat-option>
                </mat-select>
             </mat-form-field>
          </td>
          <td><input type="number" [(ngModel)]="item.price" pattern="[0-9]*" /></td>
          <td><input type="text" [(ngModel)]="item.notes" /></td>
          <td>
             <button (click)="deleteRow(i)"><i class="fa fa-trash"></i></button>
          </td>
       </tr>
       <tr>
          <td colspan="2">GrandTotal:</td>
          <td><input type="text" [value]="totalPrice()" /></td>
       </tr>
    </table>
 </div>
//////////////////////////////////////////
export class KharchReportComponent implements OnInit {
  total = 0;
  isReload: boolean;
  data: any = { name: [] };
  selectedDate!: Date | null;
  expenseFilterCtrl = new FormControl();
  purchaDipStockseDetails: any = {
    date: "",
  };
  searchText: string = "";
  filteredExpenses: string[] = [];
  // filteredExpensesList: Observable<string[]>;
  expensesList: string[] = [
    // "ASSOSIASAN FEE EXP",
    // "BANK CHARGES",
    // "BANK INTREST",
    // "BREAK FAST OPANING EXP AC",
    // "BSNL RECHARG EXP",
    // "BUILDING MARAMAT EXP",
    // "VISAN CEMERA EXP",
    // "ELETRIC BILL EXP",
    // "FIRE BOTTEL",
    // "LISAN FEES EXP",
    // "MATI PURANI EXP",
    // "PAINTING BUILDING EXP",
    // "PROFESONAL VERO EXP",
    // "SBI GENERAL INSURANCE EXP",
    // "RENT TID GJ001158 SBI POS MASHIN CHARGES",
    // "SAFAI EXP A/C",
    // "SALERY EXP A/C",
    // "STEMPING EXP",
    // "STESANARY EXP A/C",
    // "UNIFORM EXP",
    // "TRAVELING EXP A/C",
    // "VAKIL FEES EXP",
    // "VAT A/C",
    // "VYAJ",
    // "REPORT KHARCH",
  ];
  userId: string;

  constructor(
    private http: HttpClient,
    public dialogRef: MatDialogRef<KharchReportComponent>,
    private notificationService: NotificationService,
    private use: UserServiceService,
    @Inject(MAT_DIALOG_DATA) public kharch: any,private dialog: MatDialog
  ) {}

  ngOnInit() {
    if (this.kharch && this.kharch.date) {
      this.purchaDipStockseDetails.date = this.kharch.date;
    }
    this.getexpensesList();
    this.row[0].idkharch = "1";
  }

  private _filterExpenses(value: string): string[] {
    const filterValue = value.toLowerCase();
    return this.expensesList.filter((expense) =>
      expense.toLowerCase().includes(filterValue)
    );
  }

  order() {
    if (!this.isFormValid()) {
      this.notificationService.failure("Please fill all required fields.");
      return;
    }
    const data = {
      // date: this.purchaDipStockseDetails.date,
      expenses: this.row,
    };
    // Send data to backend
    this.http.post<any>(API_KHARCH_ADD, this.row).subscribe((response) => {
      // const responseData = response.expenses;
      this.notificationService.success("Kharch data succefully add.");
      this.purchaDipStockseDetails.date = null;
      this.row = [];
      this.dialogRef.close();
    });
  }
  isFormValid(): boolean {
    if (!this.purchaDipStockseDetails.date) {
      return false;
    }
    for (let item of this.row) {
      if (!item.idkharch || !item.expenses || !item.price || !item.notes) {
        return false;
      }
    }
    return true;
  }
  purchaseDetails: any = {
    date: "", // You can set default date if needed
  };
  row: any[] = [];
  lastRowId: number = 0;

  addTable() {
    // Add a new row to the table
    if (this.purchaDipStockseDetails.date) {
      this.lastRowId++;
      this.userId = localStorage.getItem("userId");
      // this.row.push({ id: '', date: this.purchaDipStockseDetails.date, notes: '', price: '' });
      const newRow = {
        idkharch: this.lastRowId,
        date: this.purchaDipStockseDetails.date,
        expenses: "",
        price: "",
        notes: "",
        userId: this.userId,
      };
      this.row.push(newRow);
    } else {
      this.notificationService.failure(
        "Please fill in all the required fields before adding a new row."
      );
    }
  }

  deleteRow(index: number) {
    // Remove a row from the table
    this.row.splice(index, 1);
  }

  totalPrice() {
    let sum = 0;
    this.row.forEach((item) => {
      sum += parseInt(item.price || "0", 10);
    });
    return sum;
  }

  cancel() {
    this.dialogRef.close({ isReload: this.isReload });
  }

  getexpensesList() {
    this.use.getexpensesList().subscribe((response) => {
      this.expensesList = response.map((item) => item.expensesList);
      this.filteredExpenses = [...this.expensesList]; // clone full list
    });
  }

  onSearchChange() {
    const query = this.searchText.toLowerCase();
    this.filteredExpenses = this.expensesList.filter((expense) =>
      expense.toLowerCase().includes(query)
    );
  }

  onSelectOpened() {
    this.searchText = "";
    this.filteredExpenses = [...this.expensesList];
  }

  expense() {
    const dialogRef = this.dialog.open(ExpensesListComponent, {
      width: "40%",
      height: "30%",
      disableClose: true,
    });

    dialogRef.afterClosed().subscribe((result) => {
      this.getexpensesList();
    });
  }
}
/////////////////////////////////////
export class ExpensesListComponent implements OnInit {

  isReload: boolean;
  inputValue: string = '';

  constructor(public dialogRef: MatDialogRef<ExpensesListComponent>,
    private user:UserServiceService,private notificationService:NotificationService
  ) { }

  ngOnInit(): void {
  }

 logInput() {
  const payload = { expensesList: this.inputValue };
  this.user.addExpence(payload).subscribe({
    next: res => {
      if (res) {
        this.notificationService.success("‚úÖ Data saved successfully.");
        this.dialogRef.close({ isReload: this.isReload });
      }
    },
    error: (err) => console.error('Error saving:', err),
  });
 }

  cancel() {
    this.dialogRef.close({ isReload: this.isReload });
  }

}
/////////////////////////////
<div class="input-container">
  <input [(ngModel)]="inputValue" placeholder="Enter text" />
  <button (click)="logInput()">Add</button>
  <button (click)="cancel()">Cancel</button>
</div>
.input-container {
    display: flex;
    align-items: center;
    gap: 10px;
    margin: 10px 0;
  }
  
  .input-container input {
    padding: 6px 12px;
    border: 1px solid #ccc;
    border-radius: 4px;
    flex: 1;
  }
  
  .input-container button {
    padding: 6px 12px;
    border: none;
    border-radius: 4px;
    background-color: #1976d2;
    color: white;
    cursor: pointer;
    transition: background-color 0.2s ease;
  }
  
  .input-container button:hover {
    background-color: #1565c0;
  }
  
  .input-container button:nth-child(3) {
    background-color: #9e9e9e;
  }
  
  .input-container button:nth-child(3):hover {
    background-color: #757575;
  }
  ////////////////////
getexpensesList():Observable<any> {
      return this.http.get<any>(API_EXPENSES_LIST); 
  }
  
  addExpence(payload: { expensesList: string }) {
    return this.http.post(API_EXPENSES_ADD, payload);
  }

export const API_EXPENSES_LIST: string = `${prefix}/portal/api/expenseslist`;
export const API_EXPENSES_ADD: string = `${prefix}/portal/api/addexpenses`;

////////////////////
 @GetMapping(value = "/expenseslist")
    public List<Expenses> getexpenseslist() {
        List<Expenses> expenses = expensesRepository.findAll();
        return expenses;
    }


    @PostMapping(value = "/addexpenses")
    public ResponseEntity<ApiResponse> saveExpense(@RequestBody  Expenses expense) {
        expensesRepository.save(expense);
        return ResponseEntity.ok(new ApiResponse("Data saved successfully."));
    }
////////////////////////////////////////////////////////////////////////////
public class Expenses {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Integer id;

    @Column(name = "expenses_list")
    private String expensesList;
////////////////////////////////////////////////////////////////////////
INSERT INTO expenseslist (expenses_list) VALUES 
('ASSOSIASAN FEE EXP')
,('BANK CHARGES')
,('BANK INTREST')
,('BREAK FAST OPANING EXP AC')
,('BSNL RECHARG EXP')
,('BUILDING MARAMAT EXP')
,('VISAN CEMERA EXP')
,('ELETRIC BILL EXP')
,('FIRE BOTTEL')
,('LISAN FEES EXP')
;
INSERT INTO expenseslist (expenses_list) VALUES 
('MATI PURANI EXP')
,('PAINTING BUILDING EXP')
,('PROFESONAL VERO EXP')
,('SBI GENERAL INSURANCE EXP')
,('RENT TID GJ001158 SBI POS MASHIN CHARGES')
,('SAFAI EXP A/C')
,('SALERY EXP A/C')
,('STEMPING EXP')
,('STESANARY EXP A/C')
,('UNIFORM EXP')
;
INSERT INTO expenseslist (expenses_list) VALUES 
('TRAVELING EXP A/C')
,('VAKIL FEES EXP')
,('VAT A/C')
,('VYAJ')
,('REPORT KHARCH')
;
